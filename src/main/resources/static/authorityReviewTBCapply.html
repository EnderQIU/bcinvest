<!DOCTYPE html>
<html lang="en" xmlns:v-on="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>审查待上链物品</title>
    <script type="text/javascript" src="js/JQuery.js"></script>
    <script type="text/javascript" src="js/vue.js"></script>
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/bootbox.min.js"></script>
<style>
    .page_change_container {
        text-align: center;
    }
    .page_change_container .page_change {
        text-decoration: underline;
        cursor: pointer;
    }
    .page_change_container .current_page {
        color: darkorange;
    }
</style>
</head>
<body>
<div class="content_container">
    <div id="company_credit_info">
        <table style="width :100%;">
            <tbody>
            <tr>
                <td class="table_head">
                    抵押物名称
                </td>

                <td class="table_head">
                    申请企业
                </td>
                <td class="table_head">
                    电话
                </td>
                <td class="table_head">
                    email
                </td>
                <td class="table_head">
                    信用值
                </td>
                <td class="table_head">
                    估值
                </td>
                <td>修改估值</td>
            <td>
                提交
            </td>

            <tr v-for ="item in GuarantyCompanyInfo">
                <td>{{ item['guarantyName'] }}</td>
                <td>{{ item['reviewCompanyInfoVO']['name'] }}</td>
                <td>{{ item['reviewCompanyInfoVO']['telNum'] }}</td>
                <td>{{ item['reviewCompanyInfoVO']['emailAddress'] }}</td>
                <td>{{ item['credit']}}</td>
                <td>{{ item['evaluateValue']}}</td>
                <td><input id="evaluate" ></input></td>
                <td><button v-on:click="update_listener(item,this.evaluate.value)">修改估值</button></td>


            </tr>


            </tbody>
        </table>
        <div class="page_change_container" v-if="max_page > 0">
            <label v-if="current_page > 0" class="page_change" v-on:click="repay_confirm_aimed_page(1)">首页</label>
            <label v-if="current_page > 1" class="page_change" v-on:click="repay_confirm_aimed_page(current_page - 1)">上一页</label>
            <label v-if="current_page > 2" class="page_change" v-on:click="repay_confirm_aimed_page(current_page - 2)">{{ current_page - 2 }}</label>
            <label v-if="current_page > 1" class="page_change" v-on:click="repay_confirm_aimed_page(current_page - 1)">{{ current_page - 1 }}</label>
            <label class="current_page" v-if="current_page > 0">{{ current_page }}</label>
            <label v-if="current_page < max_page" class="page_change" v-on:click="repay_confirm_aimed_page(current_page + 1)">{{ current_page + 1 }}</label>
            <label v-if="current_page + 1 < max_page" class="page_change" v-on:click="repay_confirm_aimed_page(current_page + 2)">{{ current_page + 2 }}</label>
            <label v-if="current_page < max_page" class="page_change" v-on:click="repay_confirm_aimed_page(current_page + 1)">下一页</label>
            <label v-if="current_page > 0" class="page_change" v-on:click="repay_confirm_aimed_page(max_page)">尾页</label>
        </div>
        <button v-on:click="click_listener">开始</button>

    </div>
</div>
<script>
    new Vue({
        el: '#company_credit_info',
        data :{

            GuarantyCompanyInfo :[],
            current_page:1,
            max_page:0,
        },
        methods:{
            getCompanyData: function (page) {
                var result =' ';
                //deal with parameter
                $.ajax({
                    method: "GET" ,
                    url: "/api/Authorization/reviewInfo/getChainInfo",
                    async: false,
                    data:{
                        pages:page,
                    },
                    beforeSend: function (request) {
                        request.setRequestHeader("user_id_token", "12345");
                    },
                    success : function(data)
                    {
                        result=data;

                    }


                });

                return result;

            },

            updateGuaranty: function(guarantyid,value){
                var result =' ';
                var r=confirm("是否确定修改");
                if(r==true) {
                    //deal with parameter
                    $.ajax({
                        method: "PUT",
                        url: "/api/Authorization/reviewInfo/updateGuarantyValue",
                        async: false,
                        data: {
                            "guaranty_id": guarantyid,
                            "value": value,
                        },
                        beforeSend: function (request) {
                            request.setRequestHeader("user_id_token", "12345");
                        },
                        success: function (data) {

                            result = data;

                        }


                    });

                    return result;
                }
            },

            update_listener:function (item,value) {
            result=this.updateGuaranty(item["guarantyId"],value);
            alert(result['message']);
            this.click_listener();
            },

            repay_confirm_aimed_page:function(page)
            {
                this.current_page=page;
                result = this.getCompanyData(page);
                this.GuarantyCompanyInfo = result;
            },
            get_max_page:function()
            {
                var result =' ';
                //deal with parameter
                $.ajax({
                    method: "GET" ,
                    url: "/api/Authorization/reviewInfo/getChainInfo/maxpages",
                    async: false,

                    beforeSend: function (request) {
                        request.setRequestHeader("user_id_token", "12345");
                    },
                    success : function(data)
                    {
                        result=data;

                    }


                });



                return result;

            },
            click_listener: function () {
                result = this.getCompanyData(this.current_page);
                this.max_page=this.get_max_page()['maxpages'];
                this.GuarantyCompanyInfo= result;
            },
        }
    })
</script>
</body>
</html>